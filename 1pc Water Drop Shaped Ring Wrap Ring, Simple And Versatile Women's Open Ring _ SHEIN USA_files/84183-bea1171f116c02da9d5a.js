"use strict";(self.webpackChunkSHEIN_W=self.webpackChunkSHEIN_W||[]).push([[84183],{515883:function(t,i,o){o.d(i,{M:function(){return N}});var n=o(194637),e=o(749293),s=o(293676),l=o(982729);const{percentNum:r,percentNumWithoutSign:u}=n.PromotionUtils,{DEBUG:a}=e.default;function c({language:t={},integrityPromotionInfo:i={},originPromotionInfo:o={},id:e="",typeId:c="",promotionNew:m={},scence:d="",options:p={}}){const _={},f=Boolean(i[e]),I=Object.assign({},i[e]||{},o);let{rangeList:h=[],ruleCrondType:E="",ruleType:P="",buyLimit:g="",discountValue:y="",singleLimitType:S="",singleNum:b="",orderNum:N="",soldNum:C="",endTimestamp:x="",isFullShop:H,memberNum:K="",mainProductRange:Y,brandName:v,rules:X}=I;const{lang:w}=gbCommonInfo;function L(i="",o=1,n={}){1==o?_.difference.text=(0,s.X)(n.amountWithSymbol,t.SHEIN_KEY_PC_16134):2==o&&(_.difference.text=(0,s.X)(i,t.SHEIN_KEY_PC_16148)),_.difference.diff=i,_.difference.diffType=o,_.difference.diffAmount=n}if(_.id=e,_.typeId=c,_.tips={text:"",list:[]},_.tip="",_.difference={text:"",diff:"",diffAmount:null,diffType:""},_.action=0,_.tipsIndex=0,_.lable="",_.rules=X||[],a&&(n.PromotionUtils.logBrowser("integrityPromotionInfo",i[e]),n.PromotionUtils.logBrowser("promotionNew",m)),1==c)f&&(_.tips.list[0]="sale_discount"==P?(0,s.X)(g,u(y),t.SHEIN_KEY_PC_18177):(0,s.X)(g,u(y),t.SHEIN_KEY_PC_18176),"cart"==d?(_.tips.text=_.tips.list[0]||"",_.tip=_.tips.text+_.difference.text,_.action=1,_.tipsIndex=0):_.tips.text=_.tips.list[0]||""),_.lable=t.SHEIN_KEY_PC_16032;else if(2==c){if(f)if("cart"==d){const F=m&&m.buyGifts&&m.buyGifts.filter((t=>t.id==e))[0]||null,T=null==F?void 0:F.all_diff,{type:D,value:A,value_amount:V}=T&&T[0]||{},O=(1==D?A:null==V?void 0:V.amountWithSymbol)||"";_.tips.list[0]=4==Y?(0,s.X)(O,v,t.SHEIN_KEY_PC_21502):(0,s.X)(O,t.SHEIN_KEY_PC_19766),1==D&&0==A||1!=D&&0==(null==V?void 0:V.usdAmount)||F&&!T?_.action=2:_.action=1,_.tips.text=_.tips.list[0]||"",_.tip=_.tips.text+_.difference.text,_.tipsIndex=0}else _.tips.list[0]=4==Y?(0,s.X)(g,v,t.SHEIN_KEY_PC_21328):(0,s.X)(g,t.SHEIN_KEY_PC_21327),_.tips.text=_.tips.list[0]||"";_.lable=4==Y?(0,s.X)(v,t.SHEIN_KEY_PC_21336):t.SHEIN_KEY_PC_16033}else if(3==c)_.tips.text=p.isMoreDiscount?t.SHEIN_KEY_PC_18042:t.SHEIN_KEY_PC_15951;else if(4==c)_.lable=t.SHEIN_KEY_PC_16033;else if(8==c)_.lable=t.SHEIN_KEY_PC_18000;else if(9==c){if(h.length)if(h.forEach(((i,o)=>{var n;"sale_discount"==P?_.tips.list[o]=(0,s.X)(i.buyLimit.amount,(100*(1-i.discountValue.amount)).toFixed(0),t.SHEIN_KEY_PC_17083):["hk","tw"].includes(w)?_.tips.list[o]=(0,s.X)(i.buyLimit.amount,(10*i.discountValue.amount).toFixed(1),t.SHEIN_KEY_PC_14555):_.tips.list[o]=(0,s.X)(i.buyLimit.amount,(100*(1-i.discountValue.amount)).toFixed(0)+"%",null===(n=t.SHEIN_KEY_PC_14555)||void 0===n?void 0:n.replace("%",""))})),m&&m.bndn){const G=m.bndn.filter((t=>t.id==e))[0];if(void 0!==G){const{range:B,next:M}=G;B<=0?(_.tips.text=_.tips.list[0]||"",_.action=1,_.tipsIndex=0):"0"!=M?(_.tips.text=_.tips.list[B]||"",_.action=1,_.tipsIndex=B-1):"0"==M&&(_.tips.text=_.tips.list[B-1]||"",_.action=0,_.tipsIndex=B-1),_.tip=_.tips.text+_.difference.text}}else _.tips.text=_.tips.list[0]||"";_.lable=t.SHEIN_KEY_PC_16032}else if(10==c||11==c){if(Object.keys(o).length)if("cart"==d)K&&K>0?_.tips.list[0]=N&&b?(0,s.X)(b,Math.min(+N,+K),t.SHEIN_KEY_PC_17482):b?2==S?(0,s.X)(Math.min(+b,+K),t.SHEIN_KEY_PC_17478):(0,s.X)(b,K,t.SHEIN_KEY_PC_17482):N?(0,s.X)(Math.min(+N,+K),t.SHEIN_KEY_PC_17478):(0,s.X)(K,t.SHEIN_KEY_PC_17478):1==S?_.tips.list[0]=(0,s.X)(b,t.SHEIN_KEY_PC_17476):2==S?_.tips.list[0]=(0,s.X)(b,t.SHEIN_KEY_PC_17478):3==S&&(_.tips.list[0]=(0,s.X)(b,N,t.SHEIN_KEY_PC_17482)),_.tips.text=_.tips.list[0]||"",_.tip=_.tips.text,_.tipsIndex=0;else{const j=Date.now(),k={1:(0,s.X)(b,t.SHEIN_KEY_PC_17383),2:"",3:(0,s.X)(b,t.SHEIN_KEY_PC_17383)}[S]||"";_.tips.list[0]=Number(g)>Number(C)&&j<Number(x)?k:"",_.tips.text=_.tips.list[0]||""}}else if(13==c){if(h.length)if(h.forEach(((i,o)=>{const n=i.ruleDimension,e=i.buyLimit.amountWithSymbol,r=i.buyLimit.amount,a=i.redemption[0].price.amountWithSymbol,c=i.redemption[0].price.amount;"quantity"==P?"price"==n?_.tips.list[o]=(0,s.X)(r,a,(0,l.l)({text:t.SHEIN_KEY_PC_17204})):"discount"==i.ruleDimension&&(_.tips.list[o]=(0,s.X)(r,u(c),(0,l.l)({text:t.SHEIN_KEY_PC_17202}))):"price"==i.ruleDimension?_.tips.list[o]=(0,s.X)(e,a,(0,l.l)({text:t.SHEIN_KEY_PC_17205})):"discount"==i.ruleDimension&&(_.tips.list[o]=(0,s.X)(e,u(c),(0,l.l)({text:t.SHEIN_KEY_PC_17203})))})),m&&m.addBuy){const R=m.addBuy.filter((t=>t.id==e))[0];if(void 0!==R){const{range:U,next:Z,diff:$,diffAmount:J}=R;if(U<=0){_.tipsIndex=0,_.action=1;const Q=h[0];_.tips.text="quantity"==P?(0,s.X)(Q.buyLimit.amount,$,(0,l.l)({text:t.SHEIN_KEY_PC_16998}))||"":(0,s.X)(Q.buyLimit.amountWithSymbol,J.amountWithSymbol,(0,l.l)({text:t.SHEIN_KEY_PC_16996}))||""}else("0"!=Z||"0"==Z)&&(_.tips.text=(0,l.l)({text:t.SHEIN_KEY_PC_16997})||"",_.action=2,_.tipsIndex=U-1);_.tip=_.tips.text+_.difference.text}}else _.tips.text=_.tips.list[0]||"";_.lable=t.SHEIN_KEY_PC_15966}else if(14==c){if(_.lable=t.SHEIN_KEY_PC_16032,_.rules.length&&_.rules.forEach(((i,o)=>{var n;let{type:e,value:l,value_amount:r,discount:u}=i||{},a=null==u||null===(n=u.value_amount)||void 0===n?void 0:n.amountWithSymbol,c=null==r?void 0:r.amountWithSymbol,m={1:(0,s.X)(a,l,t.SHEIN_KEY_PC_17542),2:(0,s.X)(l,a,t.SHEIN_KEY_PC_29568),3:(0,s.X)(a,c,t.SHEIN_KEY_PC_17541),4:(0,s.X)(c,a,t.SHEIN_KEY_PC_29567)};m[e]&&(_.tips.list[o]=m[e])})),h.length){if(H&&m&&m.fullSubtract){const q=m.fullSubtract.filter((t=>t.id==e))[0];if(void 0!==q){const{range:z,next:tt,diff:it,diffType:ot,diffAmount:nt}=q;if(z<=0)_.tipsIndex=0,_.tips.text=_.tips.list[0]||"",_.action=1,L(it,ot,nt);else if("0"!=tt)_.tips.text=_.tips.list[z]||"",_.action=1,L(it,ot,nt),_.tipsIndex=z-1;else if("0"==tt){const et=h[z-1],st=et.discountValue.amountWithSymbol,lt=et.buyLimit.amountWithSymbol,rt=et.buyLimit.amount;_.tips.text=1==E?(0,s.X)(lt,st,t.SHEIN_KEY_PC_15973)||"":(0,s.X)(rt,st,t.SHEIN_KEY_PC_15974)||"",_.action=0,_.tipsIndex=z-1}_.tip=_.tips.text+_.difference.text}}"cart"!==d&&(_.tips.text=_.tips.list[0]||""),X.find((t=>4==t.type))?_.lable=(0,s.X)(h[0].buyLimit.amountWithSymbol,h[0].discountValue.amountWithSymbol,t.SHEIN_KEY_PC_29567):X.find((t=>2==t.type))?_.lable=(0,s.X)(h[0].buyLimit.amount,h[0].discountValue.amountWithSymbol,t.SHEIN_KEY_PC_29568):_.lable=1==E?(0,s.X)(h[0].discountValue.amountWithSymbol,h[0].buyLimit.amountWithSymbol,t.SHEIN_KEY_PC_17541):(0,s.X)(h[0].discountValue.amountWithSymbol,h[0].buyLimit.amount,t.SHEIN_KEY_PC_17542)}}else if(15==c){if(_.lable=t.SHEIN_KEY_PC_16032,h.length){if(h.forEach(((i,o)=>{const n=i.discountValue.amountWithSymbol,e=i.buyLimit.amount;"cart"==d?(1==E||2==E)&&(_.tips.list[o]=(0,s.X)(e,n,t.SHEIN_KEY_PC_15977)):1==E?_.tips.list[o]=(0,s.X)(n,e,t.SHEIN_KEY_PC_15975):2==E&&(_.tips.list[o]=(0,s.X)(n,e,t.SHEIN_KEY_PC_15976))})),m&&m.eachFullQuantityPrice){const ut=m.eachFullQuantityPrice.filter((t=>t.id==e))[0];if(void 0!==ut){const{range:at,next:ct,diff:mt,diffType:dt,diffAmount:pt}=ut;if(at<=0)_.tips.text=_.tips.list[0]||"",L(mt,dt,pt),_.action=1,_.tipsIndex=0;else if("0"!=ct)_.tips.text=_.tips.list[at]||"",L(mt,dt,pt),_.action=1,_.tipsIndex=at-1;else if("0"==ct){const _t=h[at-1];_.tips.text=(0,s.X)(_t.buyLimit.amount,_t.discountValue.amountWithSymbol,t.SHEIN_KEY_PC_15977)||"",2==E&&(_.action=1),_.tipsIndex=at-1}_.tip=_.tips.text+_.difference.text}}else _.tips.text=_.tips.list[0]||"";_.lable=(0,s.X)(h[0].discountValue.amountWithSymbol,h[0].buyLimit.amount,t.SHEIN_KEY_PC_17543)}}else if(16==c)h.length&&(2==h.length?_.tips.list[0]=(0,s.X)(h[0].discount.amountWithSymbol,h[1].discount.amountWithSymbol,t.SHEIN_KEY_PC_16156):1==h.length&&(_.tips.list[0]=(0,s.X)(h[0].discount.amountWithSymbol,t.SHEIN_KEY_PC_16154)),"cart"!==d&&(_.tips.text=_.tips.list[0]||"")),_.lable=t.SHEIN_KEY_PC_16032;else if(17==c)h.length&&(2==h.length?_.tips.list[0]=(0,s.X)(r((100-100*h[0].discount.amount).toFixed(0)),r((100-100*h[1].discount.amount).toFixed(0)),t.SHEIN_KEY_PC_16155):1==h.length&&(_.tips.list[0]=(0,s.X)(r((100-100*h[0].discount.amount).toFixed(0)),t.SHEIN_KEY_PC_16153)),"cart"!==d&&(_.tips.text=_.tips.list[0]||"")),_.lable=t.SHEIN_KEY_PC_16032;else if(18==c){if(h.length)if(2==h.length?_.tips.list[0]=(0,s.X)(h[0].discount.amountWithSymbol,h[1].discount.amountWithSymbol,t.SHEIN_KEY_PC_16156):1==h.length&&(_.tips.list[0]=(0,s.X)(h[0].discount.amountWithSymbol,t.SHEIN_KEY_PC_16154)),m&&m.buySub){const ft=m.buySub.filter((t=>t.id==e))[0];0==ft.range?_.action=1:ft.range>0&&(_.action=0),_.tips.text=_.tips.list[0]||"",_.tip=_.tips.text+_.difference.text,_.tipsIndex=0}else _.tips.text=_.tips.list[0]||"";_.lable=t.SHEIN_KEY_PC_16032}else if(19==c){if(h.length)if("sale_discount"==P?2==h.length?_.tips.list[0]=(0,s.X)(u(h[0].discount.amount),u(h[1].discount.amount),t.SHEIN_KEY_PC_17085):1==h.length&&(_.tips.list[0]=(0,s.X)(u(h[0].discount.amount),t.SHEIN_KEY_PC_17084)):2==h.length?_.tips.list[0]=(0,s.X)(r(h[0].discount.amount),r(h[1].discount.amount),t.SHEIN_KEY_PC_16155):1==h.length&&(_.tips.list[0]=(0,s.X)(r(h[0].discount.amount),t.SHEIN_KEY_PC_16153)),m&&m.buySub){const It=m.buySub.filter((t=>t.id==e))[0];0==It.range?_.action=1:It.range>0&&(_.action=0),_.tips.text=_.tips.list[0]||"",_.tip=_.tips.text+_.difference.text,_.tipsIndex=0}else _.tips.text=_.tips.list[0]||"";_.lable=t.SHEIN_KEY_PC_16032}else if(20==c){if(h.length)if(h.forEach(((i,o)=>{const n=i.coupon,e=i.buyLimit.amountWithSymbol,r=n.priceSymbol;"0"!=n.isFreeShipCoupon||"0"!=n.isMemberFreeShipCoupon?_.tips.list[o]=(0,s.X)(e,(0,l.l)({text:t.SHEIN_KEY_PC_16152})):(n.couponTypeId,_.tips.list[o]=(0,s.X)(e,r,(0,l.l)({text:t.SHEIN_KEY_PC_16150})))})),m&&m.fullPriceCoupon){const ht=m.fullPriceCoupon.filter((t=>t.id==e))[0];function Et({currentRangeList:i,diffAmount:o,isReached:n}={}){const e=i.coupon,r=e.priceSymbol,u=o.amountWithSymbol,a=i.buyLimit.amountWithSymbol;return"0"!=e.isFreeShipCoupon||"0"!=e.isMemberFreeShipCoupon?(0,s.X)(a,(0,l.l)({text:t.SHEIN_KEY_PC_16152})):1==e.couponTypeId?(0,s.X)(a,r,(0,l.l)({text:t.SHEIN_KEY_PC_16150})):2==e.couponTypeId?n?(0,s.X)(a,r,(0,l.l)({text:t.SHEIN_KEY_PC_18074})):(0,s.X)(u,r,(0,l.l)({text:t.SHEIN_KEY_PC_18076})):5==e.couponTypeId?n?(0,s.X)(a,r,(0,l.l)({text:t.SHEIN_KEY_PC_18075})):(0,s.X)(u,r,(0,l.l)({text:t.SHEIN_KEY_PC_18077})):void 0}if(void 0!==ht){const{range:Pt,next:gt}=ht;if(Pt<=0){_.tips.text=_.tips.list[0]||"",_.action=1,_.tipsIndex=0;const yt=h[0];_.tip=Et({currentRangeList:yt,diffAmount:ht.diffAmount,isReached:!1})}else if("0"!=gt){_.tips.text=_.tips.list[Pt]||"",_.action=1,_.tipsIndex=Pt-1;const St=h[Pt];_.tip=Et({currentRangeList:St,diffAmount:ht.diffAmount,isReached:!1})}else if("0"==gt){_.tips.text=_.tips.list[Pt-1]||"",_.action=0,_.tipsIndex=Pt-1;const bt=h[Pt-1];_.tip=Et({currentRangeList:bt,diffAmount:ht.diffAmount,isReached:!0})}}}else _.tips.text=_.tips.list[0]||"";_.lable=t.SHEIN_KEY_PC_16035}else if(24==c){if(f){if(b=Number(b),N=Number(N),"cart"==d)["discount","sale_discount"].includes(P)?b&&N?_.tips.list[0]=(0,s.X)(Number(b),Number(N),t.SHEIN_KEY_PC_17482):b&&!N?_.tips.list[0]=(0,s.X)(Number(b),t.SHEIN_KEY_PC_17476):!b&&N&&(_.tips.list[0]=(0,s.X)(Number(N),t.SHEIN_KEY_PC_17478)):b&&N?_.tips.list[0]=(0,s.X)(Number(b),Number(N),t.SHEIN_KEY_PC_17480):b&&!N?_.tips.list[0]=(0,s.X)(Number(b),t.SHEIN_KEY_PC_17475):!b&&N&&(_.tips.list[0]=(0,s.X)(Number(N),t.SHEIN_KEY_PC_17477));else{const Nt={sale_discount:()=>`${t.SHEIN_KEY_PC_17488}${b?(0,s.X)(Number(b),t.SHEIN_KEY_PC_17489):""}${N?(0,s.X)(Number(N),t.SHEIN_KEY_PC_17493):""}`,no_discount:()=>`${b&&N?(0,s.X)(Number(b),t.SHEIN_KEY_PC_17489):b?(0,s.X)(Number(b),t.SHEIN_KEY_PC_17495):""}${N?(0,s.X)(Number(N),t.SHEIN_KEY_PC_17496):""}`},Ct="no_discount"==P?"no_discount":"sale_discount";_.tips.list[0]=Nt[Ct]()||""}_.tips.text=_.tips.list[0]||"",_.tip=_.tips.text+_.difference.text,_.tipsIndex=0,_.lable="no_discount"==P?"":t.SHEIN_KEY_PC_17484}}else if(25==c){if(h.length)if(h.forEach(((i,o)=>{_.tips.list[o]="sale_discount"==P?(0,s.X)(i.buyLimit.amountWithSymbol,r(i.discountValue.amount),t.SHEIN_KEY_PC_17835):(0,s.X)(i.buyLimit.amountWithSymbol,r(i.discountValue.amount),t.SHEIN_KEY_PC_17836)})),m&&m.fullDiscount){const xt=m.fullDiscount.filter((t=>t.id==e))[0];if(void 0!==xt){const{range:Ht,next:Kt,diffAmount:Yt}=xt;if(Ht<=0){const vt=h[0];_.tips.text="sale_discount"==P?(0,s.X)(Yt.amountWithSymbol,r(vt.discountValue.amount),t.SHEIN_KEY_PC_17809):(0,s.X)(Yt.amountWithSymbol,r(vt.discountValue.amount),t.SHEIN_KEY_PC_17807),_.action=1,_.tipsIndex=0}else if("0"!=Kt){const Xt=h[Ht];_.tips.text="sale_discount"==P?(0,s.X)(Yt.amountWithSymbol,r(Xt.discountValue.amount),t.SHEIN_KEY_PC_17809):(0,s.X)(Yt.amountWithSymbol,r(Xt.discountValue.amount),t.SHEIN_KEY_PC_17807),_.action=1,_.tipsIndex=Ht-1}else if("0"==Kt){const wt=h[Ht-1];_.tips.text="sale_discount"==P?(0,s.X)(wt.buyLimit.amountWithSymbol,r(wt.discountValue.amount),t.SHEIN_KEY_PC_17810):(0,s.X)(wt.buyLimit.amountWithSymbol,r(wt.discountValue.amount),t.SHEIN_KEY_PC_17808),_.action=0,_.tipsIndex=Ht-1}_.tip=_.tips.text+_.difference.text}}else _.tips.text=_.tips.list[0]||"";_.lable=t.SHEIN_KEY_PC_16032}else if(28==c){if("cart"==d){var W;let Lt=-1;const Wt=(null==m||null===(W=m.brandFullGifts)||void 0===W?void 0:W.filter((t=>t.id==e)))||[];if(Wt.length){const{needPrice:Ft={}}=Wt[0];Wt.forEach(((t,i)=>{1==t.isShow&&(Lt=i)})),Lt<0?(_.action=1,_.tip=4==Y?(0,s.X)(Ft.amountWithSymbol,v,t.SHEIN_KEY_PC_21501):(0,s.X)(Ft.amountWithSymbol,t.SHEIN_KEY_PC_16291)):_.action=2}}else h.forEach(((i,o)=>{_.tips.list[o]=4==Y?(0,s.X)(v,i.buyLimit.amountWithSymbol,t.SHEIN_KEY_PC_21326):(0,s.X)(i.buyLimit.amountWithSymbol,t.SHEIN_KEY_PC_21325)}));_.lable=4==Y?(0,s.X)(v,t.SHEIN_KEY_PC_21336):t.SHEIN_KEY_PC_16033,_.tips.text=_.tips.list[0]||""}return _}const{NeedDealPromotionTypeIds:m,PriorityPromotionTypeIds:d,TitlePromotionTypeIds:p,IconPromotionTypeIds:_,FullCourtPromotionTypeIds:f,BrandProductPromotionTypeIds:I}=e.default;class h{constructor({item:t=[],integrityPromotionInfo:i={},language:o={},scence:n="",promotionNew:e={}}={}){this.rawModule=[],this.integrityPromotionInfo=i,"cart"==n&&(this.promotionNew=e),this.content={},this.register({item:t,language:o,scence:n})}register({item:t,language:i,scence:o}){var e;const s="cart"===o?t.product.promotionInfo:t.promotionInfo;this.rawModule=null!=s&&s.length?s.map((e=>{const s={},{typeId:l,id:r,buyLimit:u,soldNum:a,promotion_logo_type:c,promotionLogoType:m}=e,p=31!=+l||3===c||3===m;if(d.includes(+l)&&p){var _;const c={p:e,language:i,scence:o,options:{}};[2,28].includes(+l)&&null!==(_=this.integrityPromotionInfo)&&void 0!==_&&_[r]&&"cart"==o&&delete this.integrityPromotionInfo[r].isPresent;let m={};u&&!e.originBuyLimit&&(m.originBuyLimit=u),a&&!e.originSoldNum&&(m.originSoldNum=a),c.options=n.PromotionUtils.assignOptions({item:t,p:Object.assign(e,this.integrityPromotionInfo[r]||{},m)}),"cart"==o&&(c.cartItem=t);const d=this.transformPromotionsContent(c);Object.assign(s,e,d,this.integrityPromotionInfo[r]||{})}return f.includes(+l)&&"cart"==o&&this.transformFullCourtPromotionsContent({p:e}),s.typeId=Number(l),s.sortIndex=d.indexOf(Number(l)),s})).sort(((t,i)=>t.sortIndex-i.sortIndex)):[],this.rawModule.length>1&&14==this.content.typeId&&"1"==(null===(e=this.integrityPromotionInfo[this.content.id])||void 0===e?void 0:e.isFullShop)&&(this.content=this.rawModule.find((t=>!(14==t.typeId&&"1"==t.isFullShop))))}transformPromotionsContent({p:t,language:i,cartItem:o,scence:e,options:s={}}={}){const{typeId:l,id:r,brandName:u="",mainProductRange:a}=t;var d,f;if(this.content.isVipItem=Boolean(12==l),this.content.isMoreDiscount=Boolean(s.isMoreDiscount),this.content.isLimitedItem=Boolean(s.isLimitedItem),Object.entries(p).some((([t,o])=>{if(o.includes(+l))return this.content.title=`${4==a&&I.includes(+l)?u:""} ${i[t]}`,!0})),Object.entries(_).some((([t,i])=>{if(i.includes(+l))return this.content.icon=t,!0})),[3,8].includes(+l))this.content.countDownSingle=(null===(d=this.integrityPromotionInfo[r])||void 0===d||null===(f=d.integrityContent)||void 0===f?void 0:f.countDown)||void 0;else if([10,11].includes(+l)){const{isCountdown:i,endTimestamp:o}=t;this.content.countDown="1"==i?n.PromotionUtils.countDownTime({endTimestamp:o}):""}else{var h,E;this.content.countDown=(null===(h=this.integrityPromotionInfo[r])||void 0===h||null===(E=h.integrityContent)||void 0===E?void 0:E.countDown)||void 0}if(m.includes(+l)){const n={id:r,typeId:l,language:i,integrityPromotionInfo:this.integrityPromotionInfo,promotionNew:this.promotionNew,scence:e,options:s,originPromotionInfo:t};"cart"==e&&(n.cartItem=o);const u=c(n);this.content=Object.assign(this.content,u)}return Object.assign({},this.content)}transformFullCourtPromotionsContent({p:t}={}){const{typeId:i,id:o}=t,n=4==i&&"1"==t.isPresent,e=22==i&&"1"==t.isAddBuy;(n||e)&&this.integrityPromotionInfo[o]&&this.integrityPromotionInfo[o].integrityContent&&this.integrityPromotionInfo[o].integrityContent.countDown&&(this.content.countDownFullCourt=this.integrityPromotionInfo[o].integrityContent.countDown)}}var E=o(998293),P=o(805628),g=o(843326);const{NeedFetchPromotionTypeIds:y,FetchPromotionLableTypeIds:S}=e.default;class b{constructor(){this.cache={integrityPromotionInfo:{}},this.language={}}async assignItems({items:t=[],language:i=this.language||{},scence:o="others",promotionNew:n={},isGetLable:e=!1,isGetVipPrice:s=!1,isGetSheinClubPrice:l=!1,isAppPromotion:r=!1,isGetNewFlashPromotion:u=!1,caller:a=""}={}){Object.keys(i).length||(this.language=i=await E.Z.loadByQueue("promotion"));const c=[].concat(t),m=[],d=e?S:y,p=[],_=[];let f={},I=!1,P=!1,g=!1;c.forEach((t=>{"cart"===o?t.product.promotionInfo.forEach((i=>{if(d.includes(+i.typeId)&&!m.includes(i.id)&&m.push(i.id),!d.includes(+i.typeId)){let t=JSON.parse(JSON.stringify(i));delete t.originBuyLimit,delete t.originSoldNum,f[i.id]=t}const{goods_id:o,goods_sn:n,mall_code:e}=t.product,r={goods_id:o,goods_sn:n,mall_code:e};s&&12==i.typeId?(I=!0,r.promotionId=i.id,p.push(r)):l&&29==i.typeId&&(P=!0,r.promotionId=i.id,p.push(r))})):t.promotionInfo&&t.promotionInfo.forEach((i=>{const{id:o,typeId:n,flash_type:e,flashType:r}=i,a=e||r;d.includes(+n)&&!m.includes(o)&&m.push(o);const{goods_id:c,goods_sn:f,mall_code:h}=t,E={goods_id:c,goods_sn:f,mall_code:h};s&&12==n?(I=!0,E.promotionId=o,p.push(E)):l&&29==n?(P=!0,E.promotionId=o,p.push(E)):u&&10==n&&[2,3,4].includes(a&&Number(a))&&(g=!0,E.promotionId=o,_.push(E))})),r&&"cart"!==o&&t.appPromotion&&(t.promotionInfo=t.promotionInfo.concat(t.appPromotion))})),"cart"==o&&n&&(n.fullGifts&&n.fullGifts.length>0&&n.fullGifts.forEach((t=>{m.push(t.id)})),n.fullSubtract&&n.fullSubtract.length>0&&n.fullSubtract.forEach((t=>{m.includes(t.id)||m.push(t.id)})),n.fullDiscountAll&&n.fullDiscountAll.length>0&&n.fullDiscountAll.forEach((t=>{m.includes(t.id)||m.push(t.id)})));const[b,N]=await Promise.all([this.getVipPrice({goodsParams:p,vipDiscountPrices:I,sheinClubPromotionInfo:P,caller:a}),this.getNewFlashPromotion({flashPromotionParams:_,newFlashPromotion:g,caller:a})]);let C=await this.setIntegrityPromotionInfo({ids:m});return C=Object.assign({},C,f),c.forEach((t=>{var e,s;t.promotionModule=new h({item:t,integrityPromotionInfo:C,language:i,scence:o,promotionNew:n});const l=(null==b?void 0:b[t.goods_id])||{},r=t.exclusivePromotionPrice||(null==l?void 0:l.exclusivePromotionPrice),u=t.sheinClubPromotionInfo||(null==l?void 0:l.sheinClubPromotionInfo),a=t.newFlashPromotion||(null==N||null===(e=N[t.goods_id])||void 0===e?void 0:e.newFlashPromotion)||(null==N||null===(s=N[t.goods_id])||void 0===s?void 0:s.flashZonePromotion);r&&(t.vipPrice=r),u&&(t.sheinClubPromotionInfo=u),a&&(t.newFlashPromotion=a)})),{integrityPromotionInfo:C,vipPriceList:b,items:c}}assignItemsSync({items:t=[],language:i=this.language||{},scence:o="others",promotionNew:n={},isGetLable:e=!1,isGetVipPrice:s=!1,isGetSheinClubPrice:l=!1,isAppPromotion:r=!1,isGetNewFlashPromotion:u=!1,promotionInfoFromServer:a={}}={}){const c=[].concat(t),m=[],d=e?S:y;let p={};c.forEach((t=>{var i;"cart"===o?null===(i=t.product.promotionInfo)||void 0===i||i.forEach((i=>{if(d.includes(+i.typeId)&&!m.includes(i.id)&&m.push(i.id),!d.includes(+i.typeId)){let t=JSON.parse(JSON.stringify(i));delete t.originBuyLimit,delete t.originSoldNum,p[i.id]=t}const{goods_id:o,goods_sn:n,mall_code:e}=t.product,r={goods_id:o,goods_sn:n,mall_code:e};(s&&12==i.typeId||l&&29==i.typeId)&&(r.promotionId=i.id)})):t.promotionInfo&&t.promotionInfo.forEach((i=>{const{id:o,typeId:n,flash_type:e,flashType:r}=i,a=e||r;d.includes(+n)&&!m.includes(o)&&m.push(o);const{goods_id:c,goods_sn:p,mall_code:_}=t,f={goods_id:c,goods_sn:p,mall_code:_};(s&&12==n||l&&29==n||u&&10==n&&[2,3].includes(a&&Number(a)))&&(f.promotionId=o)}));r&&"cart"!==o&&Array.isArray(t.promotionInfo)&&t.appPromotion&&(t.promotionInfo=t.promotionInfo.concat(t.appPromotion))})),"cart"==o&&n&&(n.fullGifts&&n.fullGifts.length>0&&n.fullGifts.forEach((t=>{m.push(t.id)})),n.fullSubtract&&n.fullSubtract.length>0&&n.fullSubtract.forEach((t=>{m.includes(t.id)||m.push(t.id)})),n.fullDiscountAll&&n.fullDiscountAll.length>0&&n.fullDiscountAll.forEach((t=>{m.includes(t.id)||m.push(t.id)}))),this.setCacheIntegrityPromotionInfo(a,i);let _={};for(const t of m)_[t]=this.cache.integrityPromotionInfo[t];return _=Object.assign({},_,p),c.forEach((t=>{var e,s,l;t.promotionModule=new h({item:t,integrityPromotionInfo:_,language:i,scence:o,promotionNew:n});let r=null,u=null,a=null;null!==(e=Object.keys(t.exclusivePromotionPrice||{}))&&void 0!==e&&e.length&&(r=t.exclusivePromotionPrice),null!==(s=Object.keys(t.sheinClubPromotionInfo||{}))&&void 0!==s&&s.length&&(u=t.sheinClubPromotionInfo),null!==(l=Object.keys(t.newFlashPromotion||{}))&&void 0!==l&&l.length&&(a=t.newFlashPromotion),r&&(t.vipPrice=r),u&&(t.sheinClubPromotionInfo=u),a&&(t.newFlashPromotion=a)})),{integrityPromotionInfo:_,vipPriceList:void 0,items:c}}setIntegrityPromotionInfo({ids:t=[]}={}){const i=[],o={};return t&&t.length&&t.forEach((t=>{void 0===this.cache.integrityPromotionInfo[t]?(o[t]={},i.push(t)):o[t]=this.cache.integrityPromotionInfo[t]})),i.length?(0,g.Z)({url:"/api/cart/getIntegrityPromotionInfo/get",method:"POST",data:{ids:t}}).then((t=>("0"==t.code&&t.info&&t.info.length>0&&t.info.forEach((t=>{this.dealIntegrityPromotionInfo(t),o[t.id]=this.cache.integrityPromotionInfo[t.id]=t})),o))).catch((()=>o)):Promise.resolve(o)}dealIntegrityPromotionInfo(t){const i={},{isCountdown:o,endTimestamp:e}=t;"1"==o&&e&&(i.countDown=n.PromotionUtils.countDownTime({endTimestamp:e}),i.countDownTimeStamp=1e3*e),t.integrityContent=i}async getTransformPromotionTip({language:t=this.language||{},id:i="",promotionNew:o={},scence:n="cart"}={}){Object.keys(t).length||(this.language=t=await E.Z.loadByQueue("promotion"));const e=[].concat(i),s={},l=await this.setIntegrityPromotionInfo({ids:e});return e.forEach((i=>{const e=l[i]?l[i].typeId:"";e&&(s[i]=c({language:t,integrityPromotionInfo:l,id:i,typeId:e,promotionNew:o,scence:n}))})),s}async getVipPrice({goodsParams:t=[],vipDiscountPrices:i,sheinClubPromotionInfo:o,caller:n=""}){if(null==t||!t.length||!i&&!o)return{};return await P.Z.getAtomicInfo({goods:t,fields:{vipDiscountPrices:i,sheinClubPromotionInfo:o},needAssign:!1,...n?{caller:n}:{}})}async getNewFlashPromotion({flashPromotionParams:t,newFlashPromotion:i,caller:o}){if(null==t||!t.length||!i)return{};return await P.Z.getAtomicInfo({goods:t,fields:{newFlashPromotion:i,flashZonePromotion:1},needAssign:!1,caller:o})}setCacheIntegrityPromotionInfo(t={},i={}){Object.keys(i).length&&(this.language=i),"0"==t.code&&t.info&&t.info.length>0&&t.info.forEach((t=>{this.dealIntegrityPromotionInfo(t),this.cache.integrityPromotionInfo[t.id]=t}))}}const N="undefined"!=typeof window?window.promotionCenter=window.promotionCenter||new b:new b},184183:function(t,i,o){o.d(i,{m:function(){return s}});var n=o(515883);const e=({productItem:t=null,key:i=null,value:o=null}={})=>{t&&i&&(t.pretreatInfo||(t.pretreatInfo={}),t.pretreatInfo[i]=o)},s=({products:t,promotionInfoFromServer:i,language:o})=>((({products:t=[],promotionInfoFromServer:i={},language:o={}}={})=>{n.M.assignItemsSync({items:t,isGetLable:!0,isAppPromotion:!0,promotionInfoFromServer:i,language:o}),t.forEach((t=>{const i=(t.promotionModule.rawModule||[]).filter((t=>{if(t.typeId){if(31==+t.typeId)return 3===t.promotion_logo_type;if([3,10,11].includes(+t.typeId))return!0;if(t.lable)return!0}return!1}))||[];(({productItem:t,mixPromotionInfo:i}={})=>{var o,n,e,s;const l=({serviceLabels:t})=>{var o;const n=null===(o=i[0])||void 0===o?void 0:o.lable,e=t.findIndex((t=>t.promotionLabel));e>-1&&(n?t[e].promotionLabel=n:t.splice(e,1))};l({serviceLabels:(null==t||null===(o=t.pretreatInfo)||void 0===o||null===(n=o.pcStandardView)||void 0===n?void 0:n.serviceLabels)||[]}),l({serviceLabels:(null==t||null===(e=t.pretreatInfo)||void 0===e||null===(s=e.pcBroadwiseView)||void 0===s?void 0:s.serviceLabels)||[]})})({productItem:t,mixPromotionInfo:i}),e({productItem:t,key:"mixPromotionInfo",value:i}),e({productItem:t,key:"promotionReady",value:!0})}))})({products:t,promotionInfoFromServer:i,language:o}),t)}}]);