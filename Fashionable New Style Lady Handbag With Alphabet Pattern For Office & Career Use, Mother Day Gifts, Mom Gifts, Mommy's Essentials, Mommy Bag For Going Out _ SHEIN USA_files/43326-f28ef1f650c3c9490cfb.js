"use strict";(self.webpackChunkSHEIN_W=self.webpackChunkSHEIN_W||[]).push([[43326],{800962:function(e,t,n){var r=n(382358),s=n(843326),o=n(191786),i=n(149500);const a={forgetPassword:"click_fpwordriskverify",forgetPhone:"click_fpwordriskverify",resetPhone:"click_fpwordriskverify",loginEmail:"click_loginriskverify",loginPhone:"click_loginriskverify",phoneCodeSend:"click_loginriskverify",signupEmail:"click_registerriskverify",signupPhone:"click_registerriskverify",quickRegister:"click_registerriskverify"},u=["JyRisk","JyRiskReg","JyRiskZTReg"];t.Z=class{constructor(){(0,r.Z)(this,"abtResult",{}),(0,r.Z)(this,"isSupportGeetest",!0),(0,r.Z)(this,"isShouldInit",!1),(0,r.Z)(this,"info",{}),(0,r.Z)(this,"challange",""),(0,r.Z)(this,"verifyCb",[]),(0,r.Z)(this,"gtInstance",null),(0,r.Z)(this,"from",""),(0,r.Z)(this,"isReInitStatus",!1),(0,r.Z)(this,"isGtInstanceReady",!1),(0,r.Z)(this,"errorTriggerTimes",0),(0,r.Z)(this,"reInitTimes",0),(0,r.Z)(this,"riskMaskValue",""),(0,r.Z)(this,"isResetting",!1),(0,r.Z)(this,"isSetXhrListen",!1),(0,r.Z)(this,"chanllangeTimestap",0),(0,r.Z)(this,"ajaxParams",""),(0,r.Z)(this,"staticUrl",""),(0,r.Z)(this,"fullpageJs","")}register(e,t=""){(0,s.Z)({url:`/geetest/register?riskType=${t}`,timeout:2e4}).then((n=>{var r;const{status:s,data:o}=n;if(this.fullpageJs=(null==o?void 0:o.fullpage)||"",this.staticUrl=(null==o||null===(r=o.static_servers)||void 0===r?void 0:r[0])||"",this.info=o,this.isShouldInit=0==s,this.isShouldInit)return this.chanllangeTimestap=Date.now(),this.listenXhrComplete(),void this.fetchFullPageResource(e,!!t);this.isReInitStatus&&(this.isReInitStatus=!1),"function"==typeof e&&e({status:"pass"})})).catch((t=>{this.errorReport(t,t.statusText,"/geetest/register"),this.isReInitStatus||"function"==typeof e&&e({status:"error"})}))}listenXhrComplete(){if(this.isSetXhrListen)return;this.isSetXhrListen=!0;const e=XMLHttpRequest.prototype.open,t=this;XMLHttpRequest.prototype.open=function(){let n=arguments;this.addEventListener("load",(function(){/geetest\/ajax\.php$/.test(this.responseURL)&&t.sendGtVerifyResult(this.responseText),/geetest\/reset\.php$/.test(this.responseURL)&&(t.chanllangeTimestap=Date.now(),t.recallVerfy(),t.isResetting=!1)})),this.addEventListener("error",(function(e){const r=n&&n[1];r&&/geetest\/(ajax|get|refresh|reset)\.php$/.test(r)&&(t.errorReport(e,"network error",r),t.isGtInstanceReady||"function"==typeof t.initCb&&t.initCb())})),this.addEventListener("timeout",(function(e){const r=n&&n[1];r&&/geetest\/(ajax|get|refresh|reset)\.php$/.test(r)&&(t.errorReport(e,"timeout",r),t.isGtInstanceReady||"function"==typeof t.initCb&&t.initCb())})),/geetest\/ajax\.php$/.test(n[1])&&(t.isSendingAjaxPhP=!0),e.apply(this,n)};const n=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(){!0===t.isSendingAjaxPhP&&(t.ajaxParams=arguments[0],t.isSendingAjaxPhP=!1),n.apply(this,arguments)}}sendGtVerifyResult(e){let t={};try{t=JSON.parse(e)}catch(e){}const n=t.data||{};this.riskMaskValue=n&&n.risk;let r=1;0===t.status&&"success"===n.result&&"fullpage"===n.sub_type&&(r=0);const s=a[this.from];if(!this.from)return;const o="undefined"!=typeof SaPageInfo?SaPageInfo:{start_time:Date.now()},i={verification_result:r,sessionid_shein:t.token||""};n.sub_type&&(i.sub_type=n.sub_type),n.score&&(i.score=n.score),n.result&&(i.success="success"===n.result?0:1);const u=Object.assign({},o,{activity_name:s,activity_param:i});sa("send",u)}async getGtAbtResult(e){if(!this.isSupportGeetest)return"function"==typeof e&&e({status:"not_support"});this.initCb=e;try{let t={JyRisk:{param:"on",poskeys:"JyRisk"},JyRiskReg:{param:"on",poskeys:"JyRiskReg"},JyRiskZTReg:{param:"on",poskeys:"JyRiskZTReg"}};if(this.setAbtResult(t),this.showInitGTinstance())return void this.register(e)}catch(e){this.abtResult={}}this.isShoudInitGt=!1,"function"==typeof e&&e({status:"error"})}setAbtResult(e){u.forEach((t=>{this.abtResult[t]=e[t]||{}}))}getItemResult(e){return!(this.abtResult[e]&&"off"===this.abtResult[e].param)&&this.isShouldInit}showInitGTinstance(){return!0}urlConversion(e){return e=e.replace(/^(https?:\/\/)([0-9a-z.]+)(:[0-9]+)?([/0-9a-z.]+)?(\?[0-9a-z&=]+)?(#[0-9-a-z]+)?/i,"https://$2$3$4$5$6")}fetchFullPageResource(e){if(!this.isShouldInit||!this.isSupportGeetest)return;if(1==this.isGtInstanceReady)return void this.initGeetestInstance(e);this.staticUrl=this.urlConversion(this.staticUrl);const t=`${this.staticUrl}/${this.fullpageJs}`;(0,o.M)({label:"script",attrs:{async:!0,src:t}}).then((()=>{this.initGeetestInstance(e)})).catch((t=>{i.log("fullpage.js error ......"),i.log(t),this.errorReport(t,"fullpage.js load error",""),"function"==typeof e&&e({status:"error"})}))}initGeetestInstance(e){const t={...this.info,product:"bind",lang:(n=gbCommonInfo.appLanguage,"pt-br"===n?"pt":"he"===n?"iw":n),next_width:"300px",timeout:2e4,pure:!0};var n;try{const n=new window.Geetest(t);n.onReady((()=>{this.isGtInstanceReady=!0,this.gtInstance=n,"function"==typeof e&&e({status:"complete"}),this.verifyCb.length>0&&this.gtInstance.verify()})),n.onSuccess((()=>{const{geetest_challenge:e}=n.getValidate();setTimeout((()=>{this.verifyCb.forEach((t=>{t({status:"success",challenge:e,risk:this.riskMaskValue}),this.verifyCb.shift()}))}),0)})),n.onClose((()=>{this.verifyCb.forEach((e=>{e({status:"close"}),this.verifyCb.shift()}))})),n.onError((t=>{i.log("error sdk ....",t),this.errorReport(t,"sdk error",""),"function"==typeof e&&e({status:"error"}),this.verifyCb.forEach((e=>{e({status:"error"}),this.verifyCb.shift()}))}))}catch(t){this.errorReport(t.stack,"sdk init error",""),"function"==typeof e&&e({status:"error"})}}verify(e,t=""){var n;i.log("reInitTimes",this.reInitTimes),!this.isGtInstanceReady||this.reInitTimes>=4?e({status:"error"}):(this.from=t,"function"==typeof e&&this.verifyCb.push(e),null===(n=this.gtInstance)||void 0===n||n.verify())}verifyPromise(e,t=""){return new Promise((n=>{if(!this.getItemResult(e))return n({status:"abt-off"});this.verify((e=>{n(e)}),t)}))}recallVerfy(){this.isResetting&&this.verifyCb.length>0&&this.gtInstance.verify()}reset(){this.isResetting=!0,this.gtInstance.reset()}reInitGt(e){this.reInitTimes>5||(this.reInitTimes++,this.isReInitStatus=!0,this.getGtAbtResult(e))}errorReport(e,t,n){const r=e&&e.target?e.target:e;if("object"==typeof r&&("1021"==r.error_code||"1012"==r.error_code))return;this.errorTriggerTimes++;const{SA_REPORT_URL:s}="undefined"!=typeof gbCommonInfo&&gbCommonInfo.REPORT_URL||{};"undefined"!=typeof ErrorJs&&ErrorJs.sendError("error",s+"/unusual",{errorMark:"GeeTestBrowserError",errorType:t,errorInfo:JSON.stringify(r),errorPath:n,errrorTimes:this.errorTriggerTimes})}}},512247:function(e,t,n){n.d(t,{Z:function(){return h}});const r={"/api/cart/checkcart/get":{all:!0},"/api/cart/add/create":{all:!0},"/api/cart/add_mall/create":{all:!0},"/api/cart/update":{all:!0},"/api/cart/update_attr_mall/update":{all:!0},"/api/cart/delete":{all:!0},"/api/cart/batchDelete/update":{all:!0},"/cart/saveforlater":{all:!0},"/api/user/wishlist/add":{all:!0},"/api/cart/batchWishGoods/update":{all:!0},"/api/checkout/paymentList/get":{all:!1,excludes:["card_no","card_pin"]},"/api/checkout/shippingList/get":{all:!1,excludes:["card_no","card_pin"]},"/checkout/cacu_total":{all:!0},"/api/checkout/mallCacuTotal/get":{all:!0},"/api/checkout/order/update":{all:!1,includes:["editType"]},"/checkout/switch_payment":{all:!0},"/ltspc/pay/unPay/unifiedPay":{all:!1,includes:["billno","paymentCode","routeId"]},"/ltspc/pay/binCheck":{all:!0},"/ltspc/pay/preRouting":{all:!0},"ltspc/pay/unPay/complete":{all:!0}},s=[{path:/^\/user\/orders\/detail\/\w+/,all:!0}];var o=n(149500);const i=[];let a="";const u=[],l=[/^\/(api\/)?(cart|user|checkout|getCouponListForOrderStore|getCouponListForOrder|pay|ltspc)/],c=["language","theme"],d=[0,1e3,-1],{NODE_SERVER_ENV:p,langPath:f}=gbCommonInfo;var h=new class{constructor(){this.init()}init(){"undefined"!=typeof $&&$(document).on("ajaxComplete",((e,t,n)=>{this.sendReport(e,t,n)}))}isFilterRoute(e){const t=e&&e.url&&e.url.split("?")[0];return u.includes(t)}isIncluseRoutes(e){const t=e;return l.some((e=>e.test(t)))}isReportCode(e={},t){const n=e&&Object.prototype.hasOwnProperty.call(e,"code")?e.code:"undefined";return"undefined"===n?t&&200!=t.status:!d.includes(parseInt(n,10))}isFilterEnvs(){return i.includes(p)}isFilterArea(e){return c.includes(e)}transformResponse(e){let t={};try{e.responseType&&"json"==e.responseType?t=e.response||e.responseJson:e.responseText&&(t=JSON.parse(e.responseText))}catch(t){o.log(e),o.log(t)}return t}parseString(e){try{return JSON.stringify(e)}catch(e){return""}}formatReportParams(e,t={},n,r={}){return"object"==typeof t&&Object.keys(t).forEach((n=>{this.isFilterArea(n)||("object"==typeof t[n]?e[n]=this.parseString(t[n]):e[n]=t[n])})),e=this.addRequstParams(e,n,r)}parseRequestParams(e,t=""){if("[object Object]"==Object.prototype.toString.call(e))return e;let n=Object.create(null);if("[object String]"==Object.prototype.toString.call(e)){if(t.includes("application/json")){try{n=JSON.parse(e)}catch(e){}return n}if(!(e=e.trim().replace(/^(\?|#|&)/,"")))return n;e.split("&").forEach((function(e){let t=e.replace(/\+/g," ").split("="),r=t.shift(),s=t.length>0?t.join("="):void 0;if(r=decodeURIComponent(r),r.endsWith("[]")&&(r=r.slice(0,-2)),void 0===s)s=null;else try{s=decodeURIComponent(s)}catch(e){}void 0===n[r]?n[r]=s:Array.isArray(n[r])?n[r].push(s):n[r]=[n[r],s]}))}return n}getRequestData(e,t){return"GET"==t.type?e.apiSearch||"":t.data||null}getNeedParsePath(e){const{apiPath:t}=e;let n={};if(r[t])return n=r[t],{isNeed:!0,pathConfig:n};const o=s.find((e=>{const{path:n}=e;return!!new RegExp(n).test(t)}));return o?{isNeed:!0,pathConfig:o}:{isNeed:!1,pathConfig:n}}addRequstParams(e,t,n={}){var r,s;const o=this.getRequestData(e,n);if(!o)return e;const{isNeed:i,pathConfig:a}=this.getNeedParsePath(e);if(!i)return e;const u=(null===(r=n.headers)||void 0===r?void 0:r["Content-Type"])||(null===(s=n.headers)||void 0===s?void 0:s["content-type"])||"",l=this.parseRequestParams(o,u),{includes:c=[],excludes:d=[],all:p}=a;let f={};return p?(f=l,e.requestParams=JSON.stringify(f),e):c.length>0?(c.forEach((e=>{void 0!==l[e]&&(f[e]=l[e])})),e.requestParams=JSON.stringify(f),e):d.length>0?(Object.keys(l).forEach((e=>{d.includes(e)||(f[e]=l[e])})),e.requestParams=JSON.stringify(f),e):(e.requestParams=JSON.stringify(f),e)}formatApiPath(e){const t=e.indexOf("/ltspc");return t>=0?e.slice(t):e.replace(f,"")}getPublicParams(e,t){const n={};let[r="",s=""]=t.url&&t.url.split("?")||[];const o=document.createElement("a");return o.href=r,r=o.pathname,n.apiPath=this.formatApiPath(r),this.customParam({obj:n,xhr:e,opts:t}),n.apiSearch=s,n.userAgent=navigator&&navigator.userAgent||"",n.page_name=window.getSaPageInfo&&window.getSaPageInfo.page_name||window.SaPageInfo&&window.SaPageInfo.page_name||"",n.status_code=e.status,n.cookieSize=document&&document.cookie&&document.cookie.length,n.hrefSize=location&&location.href&&location.href.length,n}customParam({obj:e,xhr:t,opts:n}){if(e.apiPath.indexOf("/unifiedPay")>-1){let t=n.data.split("&");t=t.filter((e=>e.indexOf("paymentCode")>-1)),t=t[0]&&t[0].split("=")||[];const r=t[1]||"";e.payment_code=r}}sendReport(e,t={},n={}){try{if(this.isFilterEnvs())return;const e=this.transformResponse(t);if(!this.isReportCode(e,t))return;const r=this.getPublicParams(t,n);if(this.isFilterRoute(n))return;if(!this.isIncluseRoutes(r.apiPath))return;if("undefined"==typeof sa)return;this.formatReportParams(r,e,t,n),this.report(r)}catch(e){o.log(e)}}sendReportForScHttp(e){this.sendReport(null,null==e?void 0:e.request,null==e?void 0:e.config)}report(e){try{if("undefined"==typeof sa)return;if(!a){const{SA_REPORT_URL:e}=gbCommonInfo.REPORT_URL;a=`${e}/orgSsaUnusual`}window.sa("error",a,e)}catch(e){o.log(e)}}}},741997:function(e,t,n){n.d(t,{V:function(){return l}});var r=n(800962),s=n(843326),o=n(626720);const i=new r.Z,a="_f_c_llbs_";async function u(e){const t={901:"slide",902:"icon"}[e]||"";if(!t){return{status:"geetest_error",msg:"captcha_type not support"}}const n=await function(e){return new Promise((t=>{i.register(t,e)}))}(t),{status:r}=n;if("error"==r){return{status:"geetest_error",msg:"geetest init error"}}const{status:s,challenge:o,risk:a}=await i.verifyPromise("","flow_challenge");if("close"==s){return{status:"geetest_close",msg:""}}if("error"==s){return{status:"geetest_error",msg:"geetest request error"}}return{status:"success",challenge:o,risk:a}}async function l(e,t){const n=await u(e),{status:r,challenge:i,risk:l}=n;if("success"!=r)return n;const c={challenge:i,captcha_type:e,gRisk:l},d=await(0,s.Z)({url:"/api/risk/flow_check",method:"POST",data:c}).catch((e=>e)),p={status:0==d.status?"success":"risk_error",code:d.status,llbs:d.llbs||""};if(0==d.status){const e=parseInt(t)||0;(0,o.d)({key:a,value:d.llbs,end:2*e})}return p}},843326:function(e,t,n){n.d(t,{s:function(){return u}});var r=n(154815),s=n(251343),o=n(203510),i=n(100792);const a=(()=>{if("undefined"==typeof window)return r.Z;const e=r.Z.create({baseURL:gbCommonInfo.langPath,headers:{common:{"x-csrf-token":gbCommonInfo.csrf_token,"x-requested-with":"XMLHttpRequest"}},params:{_ver:"1.1.8",_lang:gbCommonInfo.appLanguage}});return e.updateXCsrfToken=async t=>{if(!t){const n=await e({url:"/api/common/csrf/update"}).catch((()=>({})));if(!n.updateCs)return!1;t=n.updateCs}return e.defaults.headers.common["x-csrf-token"]=t,gbCommonInfo.csrf_token=t,t},e.interceptors.request.use(o.rh),e.interceptors.request.use(o.pp.hold),e.interceptors.request.use(o.kV.startRootSpan),e.interceptors.request.use(o.UJ),e.interceptors.response.use(o.t$.success,o.t$.error),e.interceptors.response.use(o.OI),e.interceptors.response.use(o.pp.replay(e)),e.interceptors.response.use(o.Cw),e.interceptors.response.use(o.p),e.interceptors.response.use(o.kV.success,o.kV.error),e.interceptors.response.use(o.Am),s.Z.intercept(e),e.interceptors.response.use((e=>{var t;return null!==(t=e.config.schttp)&&void 0!==t&&t.getResponse?e:e.data}),(e=>{var t,n;throw null!==(t=e.config)&&void 0!==t&&null!==(n=t.schttp)&&void 0!==n&&n.getResponse||!e.request?e:e.request})),window.schttp=e,e})();function u(){a({url:"/api/config/sampleControlConfig/get",method:"post"}).then((({code:e,info:t})=>{0===Number(e)&&(0,i.setLocalStorage)({key:"sky_eye_sample_control_config",value:t.skyEyeConfig||{},expire:36e5})}))}t.Z=a},203510:function(e,t,n){n.d(t,{QD:function(){return h},t$:function(){return w},rh:function(){return y},OI:function(){return _},p:function(){return I},UJ:function(){return g},Cw:function(){return R},Am:function(){return P},pp:function(){return k},kV:function(){return S}});var r=n(382358),s=n(512247),o=n(828665);const i={5501:"10011000",5502:"10011001",5503:"10011002",5510:"10011003",5511:"10011004",5512:"10011005",5520:"10011006"};var a=n(741997),u=n(370371),l=n.n(u),c=n(100792),d=n(843326),p=n(149500);function f(e,t={}){var n;"undefined"!=typeof window&&(null===(n=window.TPM)||void 0===n||n.run({marketing:"ClientAnalytics",method:"_defineTrack",params:{data:e,options:t}}))}function h(e){const t=function(e){if("undefined"==typeof window||!window.AntiIn)return"";if(!gbCommonInfo.SYNC_ANTIIN_URLS.some((t=>e.includes(t))))return"";const t=window.AntiIn;return t._last?t._last:(t._calculating=t.syncGetAllEncrypted(t.Channel.PC),t._last=t._calculating,setTimeout((()=>t._last=void 0),200),t._calculating)}(e.url)||"",n={};return t&&(n["Anti-In"]=t),e.headers=Object.assign(n,e.headers),e}async function g(e){const t=await async function(e){if("undefined"==typeof window||!window.AntiIn)return"";if(!gbCommonInfo.ANTIIN_URLS.some((t=>e.includes(t))))return"";const t=window.AntiIn;return t._last?t._last:(t._calculating||(t._calculating=t.getAllEncrypted(t.Channel.PC).then((e=>(t._calculating=null,setTimeout((()=>t._last=void 0),200),t._last=e))).catch((()=>""))),await t._calculating)}(e.url)||"",n={};return t&&(n["Anti-In"]=t),e.headers=Object.assign(n,e.headers),e}let m=!0;async function y(e){var t,n;if("undefined"==typeof window||"undefined"==typeof gbCommonInfo)return e;e.customdata||(e.customdata={});let r=l().getUri(e);if(r.startsWith("http")){if(!r.startsWith(location.origin))return e;r=r.replace(location.origin,"")}let s="";const o=Date.now();if(e.customdata.requestStartTime=o,e.customdata.subUrl=null===(t=r.split("?"))||void 0===t?void 0:t[0],e.customdata.sigUrl=r,null===(n=gbCommonInfo)||void 0===n||!n.OPEN_SIGNATURE)return e;try{s=await window._SHEIN_CALC_SIGNATURE_(r);let e="signature_compute_time";m&&(m=!1,e="signature_compute_time_first"),f({data:[{key_path:e,values:{num:100*(Date.now()-o)}}]},{random:.05})}catch(e){var i,a,u;if("undefined"!=typeof window&&"undefined"!=typeof gbCommonInfo)window.ErrorJs.sendError("error",`${null===(i=gbCommonInfo)||void 0===i||null===(a=i.REPORT_URL)||void 0===a?void 0:a.SA_REPORT_URL}/unusual`,{errorMark:"signature_compute_error",errorInfo:{stack:null==e?void 0:e.stack,message:null==e?void 0:e.message,sigFileName:null===(u=gbCommonInfo)||void 0===u?void 0:u.SIG_FILE_NAME,sigUrl:r}})}return e.headers["x-gw-auth"]=s,e}function _(e){var t,n;const r=Number(null==e||null===(t=e.data)||void 0===t?void 0:t.code),s=Number(null==e||null===(n=e.data)||void 0===n?void 0:n.sub_code);return 836e3===r&&5501===s&&location.reload(),e}let v=!1;function I(e){var t;return[/\/api\/user\/wishlist(?!\/((check\/good)|(group\/optional\/goods\/get)|(redpoint\/get)))/].some((t=>t.test(e.config.url)))&&void 0!==(null===(t=e.data)||void 0===t?void 0:t.code)&&(-4!=+e.data.code&&-2!=+e.data.code||(v||(v=!0,(0,o.a)({message:gbCommonInfo.language.SHEIN_KEY_PC_17753,type:"none",offset:186,onClose:()=>v=!1})),e.data.code=-1,e.data.originCode=-4)),e}function R(e){var t;return null!==(t=e.config.schttp)&&void 0!==t&&t.needLogin&&e.data&&(300206!=+e.data.code&&"need login"!==e.data.msg||(location.href=gbCommonInfo.langPath+"/user/logout")),e}const w={success:function(e){var t,n,r,o,a,u,l,c,d,h;if(null!=e&&null!==(t=e.config)&&void 0!==t&&null!==(n=t.schttp)&&void 0!==n&&n.apiLogSkip)return e;if((null==e||null===(r=e.config)||void 0===r||null===(o=r.customdata)||void 0===o?void 0:o.requestStartTime)>0){var g,m,y,_;const t=Date.now()-((null==e||null===(g=e.config)||void 0===g||null===(m=g.customdata)||void 0===m?void 0:m.requestStartTime)||0);f({resource:(null==e||null===(y=e.config)||void 0===y||null===(_=y.customdata)||void 0===_?void 0:_.subUrl)||"other",data:[{key_path:"request_time",values:{num:t}}]},{random:.05})}try{if(s.Z.sendReportForScHttp(e),!0==(836e3===Number(null==e||null===(a=e.data)||void 0===a?void 0:a.code)))f({resource:(null==e||null===(u=e.config)||void 0===u||null===(l=u.customdata)||void 0===l?void 0:l.subUrl)||"other",data:[{key_path:"request_error_signature",values:{status_code:String(i[Number(null==e||null===(c=e.data)||void 0===c?void 0:c.sub_code)]||0),info:{message:null==e||null===(d=e.config)||void 0===d||null===(h=d.customdata)||void 0===h?void 0:h.sigUrl}}}]},{immediate:!0})}catch(e){p.log(e)}return e},error:function(e){var t,n,r;void 0!==(null==e?void 0:e.request)&&(s.Z.sendReportForScHttp(e),f({resource:(null==e||null===(t=e.config)||void 0===t||null===(n=t.customdata)||void 0===n?void 0:n.subUrl)||"other",data:[{key_path:"request_error",values:{status_code:`10010${null==e||null===(r=e.request)||void 0===r?void 0:r.status}`}}]},{immediate:!0}));throw e}},b={name:"rewriteSignature",active:()=>gbCommonInfo.OPEN_SIGNATURE&&("gray"===gbCommonInfo.NODE_SERVER_ENV||"production"===gbCommonInfo.NODE_SERVER_ENV),range:()=>!0,check:({data:e})=>836e3==(null==e?void 0:e.code)&&5511==(null==e?void 0:e.sub_code),fix:()=>window._SHEIN_SYNC_TIMESTAMP_(gbCommonInfo.langPath+"/_openapi_gateway_/timestamp")},C={name:"geetest",active:()=>!0,range:({url:e})=>[/\/cart\/update/,/\/cart\/add_mall/,/\/api\/comment\/abcCommentImages\/query/,/\/api\/comment\/abcCommentInfo\/query/,/\/goods_detail_nsw\/getCommentByAbc/,/\/goods_detail_nsw\/getCommentInfoByAbc/].some((t=>t.test(e))),check:({data:e})=>{var t;return 836100==(null==e?void 0:e.code)&&(null==e?void 0:e.sub_code)&&(null==e||null===(t=e.attachment)||void 0===t?void 0:t.cookie_duration)},fix:({data:e})=>(0,a.V)(e.sub_code,e.attachment.cookie_duration).then((e=>{if("success"!==e.status)throw"geetest_close"!==e.status&&(0,o.a)({type:"error",message:gbCommonInfo.language.SHEIN_KEY_PC_16509}),e}))};const k=new class{constructor(e){(0,r.Z)(this,"replayQueue",{}),(0,r.Z)(this,"plugins",[]),(0,r.Z)(this,"_seed",9999),"undefined"!=typeof window&&"undefined"!=typeof gbCommonInfo&&(e.forEach((({name:e,active:t,range:n,check:r,fix:s})=>{"string"==typeof e&&"function"==typeof t&&"function"==typeof n&&"function"==typeof r&&"function"==typeof s&&t()&&this.plugins.push({pluginName:e,range:n,check:r,fix:s,groupId:0})})),this.interceptor={hold:this._hold.bind(this),replay:e=>t=>this._replay(t,e)})}async _hold(e){return e.customdata||(e.customdata={}),e.customdata.groupId={},await Promise.all(this.plugins.map((async t=>{t.range(e)&&await t.holdingPromise,e.customdata.groupId[t.pluginName]=t.groupId}))),e}async _replay(e,t){var n,r;const s=null===(n=e.config)||void 0===n||null===(r=n.customdata)||void 0===r?void 0:r.groupId;if(!s)return e;const o=e.config.headers["x-gw-replay"];if(o)throw this.replayQueue[o](e),delete this.replayQueue[o],new Error("abandon from replay");let i=!0,a=!1;if(await Promise.all(this.plugins.map((async t=>{if(t.check(e)){i=!1;await this._doFix(e,s,t)||(a=!0)}}))),i||a)return e;const u=this._createUniqueId(),l=this._saveQueue(u);return t(this._resetConfig(u,e.config)).catch((e=>p.log("replay success: ","abandon from replay"===e.message))),l}async _doFix(e,t,n){return t[n.pluginName]!==n.groupId||n.holdingPromise?n.holdingPromise:n.holdingPromise=(async()=>{let t=!0;try{await n.fix(e)}catch(e){p.error(e),t=!1}return n.groupId++,delete n.holdingPromise,t})()}_createUniqueId(){return this._seed<1e3&&(this._seed=9999),this._seed--}_saveQueue(e){let t=null;const n=new Promise((e=>t=e));return this.replayQueue[e]=t,n}_resetConfig(e,t){return t.headers["x-gw-replay"]=e,delete t.headers["x-gw-auth"],delete t.headers["x-csrf-token"],t}}([b,C]).interceptor,S={_getRandomString(e,t="0123456789"){let n="";for(let r=e;r>0;--r)n+=t[Math.floor(Math.random()*t.length)];return n},_getRootSpanInfo(){const{_getRandomString:e}=S,t=`ff${e(14,"0123456789abcdef")}`.toString();return{traceID:t,spanID:t}},_sampleControlConfig:null,_getSampleRate(e){if("undefined"==typeof window||"undefined"==typeof gbCommonInfo)return 0;if(["localhost","debug","gray"].includes(gbCommonInfo.NODE_SERVER_ENV))return 1;let t=null;if(S._sampleControlConfig){const{value:e,end:n}=S._sampleControlConfig;t=e,Date.now()>n&&(S._sampleControlConfig=null)}else{const e=(0,c.getLocalStorage)("sky_eye_sample_control_config");e&&(t=e,S._sampleControlConfig={value:e,end:Date.now()+18e5})}if(t){var n;const r=null===(n=t.apiMap)||void 0===n?void 0:n[e.url];return r?Number(r.prop):Number(t.prop)||.001}return"/api/config/sampleControlConfig/get"!==e.url&&(0,d.s)(),.001},_getSampleFlag(e){const{_getSampleRate:t}=S;return Math.random()<t(e)?1:0},startRootSpan(e){if("undefined"==typeof window||"undefined"==typeof gbCommonInfo)return e;const{_getRootSpanInfo:t,_getSampleFlag:n}=S,{traceID:r}=t(),s=n(e);return e.headers["uber-trace-id"]=`${r}:${r}:0:${s}`,e},_buildTraceSpanData(e,t){var n,r,s,o,i;if("undefined"==typeof window||"undefined"==typeof gbCommonInfo||!e||!t)return null;const{headers:a={},customdata:u={},method:l,url:c=""}=e,d=(null==a?void 0:a["uber-trace-id"])||"",[p="",,,f]=(null==d||null===(n=d.split)||void 0===n?void 0:n.call(d,":"))||[];if("1"!==f)return null;const h=null==u?void 0:u.requestStartTime,g=Date.now()-(h||0),{page_name:m}=window.getSaPageInfo||window.SaPageInfo||{},y=`${S._getSampleRate(e)}`,_="1"===y?"cons":"probabilistic",{headers:v}=t,I=(null==v?void 0:v["x-tracer-name"])||(null==c||null===(r=c.split)||void 0===r||null===(s=r.call(c,"?"))||void 0===s?void 0:s[0])||"/",{IS_RW:R,SERVER_TYPE:w="",NODE_SERVER_ENV:b=""}=gbCommonInfo,C=`${R?"romwe":"shein"}-PC-${w}-${b}`;return{traceID:p,spanID:p,parentID:"",startTime:h,duration:g,operationName:I,api:I,url:c||"",method:(null===(o=(i=l||"").toUpperCase)||void 0===o?void 0:o.call(i))||"",statusCode:t.status||504,ID:"fdf304b4-9e52-56e1-b9be-159baeafb0b9",host:C,page:m,authName:"",samplerType:_,samplerParam:y,spanKind:"client"}},success(e){if("undefined"==typeof window||"undefined"==typeof gbCommonInfo)return e;const{headers:t,config:n}=e||{};if(!t||!n)return e;if(null!=t&&t["x-recognize-cache"])return e;const r=S._buildTraceSpanData(n,e);return r?(f({data:[{key_path:"trace-span",values:{span_info:JSON.stringify(r)}}]},{random:1}),e):e},error(e){if("undefined"==typeof window||"undefined"==typeof gbCommonInfo)throw e;const{config:t,response:n}=e||{};if(!t)throw e;const{headers:r}=n||{};if(null!=r&&r["x-recognize-cache"])throw e;const s=S._buildTraceSpanData(t,n);if(!s)throw e;throw f({data:[{key_path:"trace-span",values:{span_info:JSON.stringify(s)}}]},{random:1}),e}};function P(e){if("undefined"!=typeof window){const t=e.headers,n=t["Client-Ipver"]||t["client-ipver"]||(null!=t&&t.get?null==t?void 0:t.get("Client-Ipver"):"")||"",r=t["Client-Ipaddr"]||t["client-ipaddr"]||(null!=t&&t.get?null==t?void 0:t.get("Client-Ipaddr"):"")||"";n&&(window.__CLIENT_IPVER__=n),r&&(window.__CLIENT_IPADDR__=r)}return e}},154815:function(e,t,n){var r=n(370371),s=n.n(r),o=n(149500);const i=[],a=[];function u(e){try{i.forEach((t=>e.interceptors.request.use(...t))),a.forEach((t=>e.interceptors.response.use(...t)))}catch(e){o.error("assignInterceptors error",e)}return e}"undefined"!=typeof window&&(s()._create=s().create,s().create=function(e){return u(s()._create(e))},u(s())),t.Z=s()}}]);